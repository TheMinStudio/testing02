<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏à‡∏≠‡∏á‡πÄ‡∏Å‡∏° 24</title>
<style>
body {margin:0;height:100vh;background:#0d1117;display:flex;justify-content:center;align-items:center;font-family:Arial;color:white;}
.card {background:#161b22;padding:30px;border-radius:12px;width:300px;}
input,button {width:100%;padding:12px;margin-top:12px;border-radius:8px;border:none;}
button {background:#2ea043;color:white;font-size:16px;cursor:pointer;}
.loading {position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;flex-direction:column;justify-content:center;align-items:center;}
.loading.show {display:flex;}
.queue {font-size:64px;color:#58a6ff;margin-top:10px;}
</style>
</head>
<body>

<div class="card">
  <h2>‡∏à‡∏≠‡∏á‡πÄ‡∏Å‡∏° 24</h2>
  <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠">
  <input id="class" placeholder="‡∏ä‡∏±‡πâ‡∏ô/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠">
  <button onclick="reserve()">‡∏à‡∏≠‡∏á</button>
</div>

<div id="loading" class="loading">
  <div>‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà</div>
  <div id="queue" class="queue">‚è≥</div>
</div>

<audio id="alertSound" src="https://www.myinstants.com/media/sounds/bell.mp3"></audio>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwYs6_VhY8HTGjv1NAqovVNLMEmMDd0zeJNewbzJ6JW1Hg-SOv9AjPlIOzwhXI1Ryxd/exec";
let userName = "";
let intervalId = null;

function reserve() {
  userName = document.getElementById("name").value.trim();
  const cls = document.getElementById("class").value.trim();
  if (!userName || !cls) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡πâ‡∏ô/‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠");

  document.getElementById("loading").classList.add("show");
  document.getElementById("queue").innerText = "‚è≥";

  fetch(WEB_APP_URL, {
    method: "POST",
    body: new URLSearchParams({name:userName,className:cls,game:"24Game"})
  })
  .then(() => {
    intervalId = setInterval(updateQueue, 2000);
    updateQueue();
  })
  .catch(err=>{
    console.error(err);
    document.getElementById("queue").innerText="ERR";
  });
}

function notifyUser(msg){
  if(Notification.permission==="granted") new Notification(msg);
  else if(Notification.permission!=="denied"){
    Notification.requestPermission().then(p=>{
      if(p==="granted") new Notification(msg);
    });
  }
}

function updateQueue(){
  fetch(`${WEB_APP_URL}?name=${encodeURIComponent(userName)}&game=24Game`)
    .then(r=>r.text())
    .then(q=>{
      q = q.trim();
      const qInt = parseInt(q,10);
      const queueEl = document.getElementById("queue");

      if(!q || isNaN(qInt) || qInt===0) queueEl.innerText="‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ßüòÄ";
      else queueEl.innerText=qInt;

      if(qInt===1){
        document.getElementById("alertSound").play();
      }
    })
    .catch(err=>{
      console.error(err);
      document.getElementById("queue").innerText="ERR";
    });
}
</script>

</body>
</html>
